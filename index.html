<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<title>Metronome for New Music</title>

	<link rel="stylesheet" type="text/css" href="./style/basic.css">
</head>
<body>	
	<div id="Content">

		<div id="Title">Metronome for New Music</div>
		<div id="Explanation">
			This metronome can be customized to loop through non-conventional time signatures. 
		</div>

		<br>
		<table id="theTable">
			<tr>
				<th></th>
				<th>Tempo</th>
				<th>Beats</th>
				<th>Loops</th>
				<th>Accents</th>
				<th></th>
			</tr>
		</table>

		<br>
		<button onclick="addPattern()">Add</button>
		<button onclick="playPiece()">Play</button>
	</div>


	<script>
		const patterns = [];

		const playPiece = function() {
			console.log("Not implemented...");
		}

		const addPattern = function() {
			const table = document.getElementById("theTable");
			const row = table.insertRow();
			pattern = {
				tempo: 120,
				beats: 4,
				loops: 1,
				accents: [1],
				row: row
			}
			row.addEventListener("click", function(e) {
				console.log(e.target.name);
				if (e.target.name === "delete") {
					deletePattern(pattern);
				}
			});
			row.addEventListener("change", function(e) {
				console.log(e);
				if(e.target.name === "tempo") {
					pattern.tempo = e.target.value;
				}
				if(e.target.name === "beats") {
					pattern.beats = e.target.value;
					displayPattern(pattern);
				}
				if(e.target.name === "loops") {
					pattern.loops = e.target.value;
				}
				if(e.target.name.startsWith("accent-")) {
					let i = +e.target.name.replace("accent-", "");
					pattern.accents[i] = e.target.checked ? 1 : 0;
				}
			});
			patterns.push(pattern);
			displayPattern(pattern);
		}

		const displayPattern = function(p) {
			p.row.innerHTML = "";
			const cell0 = p.row.insertCell(); // change cell0 to play, element0 to something meaningful
		    const element0 = document.createElement("input");
		    element0.type = "button";
		    element0.name = "play";
		    element0.value = "play";
		    cell0.appendChild(element0);

		    const cell1 = p.row.insertCell();
		    const element1 = document.createElement("input");
		    element1.type = "number";
		    element1.name = "tempo";
		    element1.value = p.tempo;
		    element1.min = "10";
		    element1.max = "300";
		    cell1.appendChild(element1);

		    const cell2 = p.row.insertCell();
		    const element2 = document.createElement("input");
		    element2.type = "number";
		    element2.name = "beats";
		    element2.value = p.beats;
		    element2.min = "1";
		    element2.max = "16";
		    cell2.appendChild(element2);

		    const cell3 = p.row.insertCell();
		    const element3 = document.createElement("input");
		    element3.type = "number";
		    element3.name = "loops";
		    element3.value = p.loops;
		    element3.min = "1";
		    element3.max = "300";
		    cell3.appendChild(element3);

		    const cell4 = p.row.insertCell();
		    for(let i = 0; i < p.beats; i++) {
		    	const checkbox = document.createElement("input");
		    	checkbox.type = "checkbox";
			    checkbox.name = "accent-" + i;
			    checkbox.checked = p.accents[i] ? "checked" : "";
			    cell4.appendChild(checkbox);
		    }

		    const cell5 = p.row.insertCell();
		    const element5 = document.createElement("input");
		    element5.type = "button";
		    element5.value = "delete";
		    element5.name = "delete";
		    cell5.appendChild(element5);
		}

	</script>
</body>
</html>
